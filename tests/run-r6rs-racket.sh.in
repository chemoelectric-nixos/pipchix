#!@SHELL@
#
# Run a tiny Râ¶RS program in Racket (plt-r6rs).
#

prog_scm=`@abs_top_builddir@/tempname`.scm

cat > "${prog_scm}" <<EOF
#!r6rs
(import (except (rnrs (6)) fold-right member assoc map remove)
        (rnrs mutable-strings (6))
        (for (pipchix general-purpose cut) run expand)
        (pipchix general-purpose list)
        (pipchix general-purpose match)
        (pipchix general-purpose division)
        (for (pipchix general-purpose e-macros) run expand)
        (pipchix general-purpose combinators)
        (for (pipchix general-purpose eager-syntax) run expand)
        (for (pipchix general-purpose eager-macros) run expand)
        (for (pipchix general-purpose ec) run expand)
        (pipchix general-purpose continuation-capture)
        (pipchix abstract-syntax-tree)
        (pipchix nix-embed)
        (pipchix nix-list)
        (pipchix string-manipulation)
        (pipchix essentials))
(output-nix-abstract-syntax-tree $1)
(exit 0)
EOF

env LC_ALL="@TEST_LOCALE@" \
    LANG="@TEST_LOCALE@" \
    @PLT_R6RS@ ++path '@abs_top_builddir@/r6rs' "${prog_scm}"

rm "${prog_scm}"

exit 0

# local variables:
# mode: shell-script
# sh-shell: sh
# end:
