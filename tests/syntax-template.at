# Copyright © 2025 Barry Schwartz
#
# This file is part of Pipchix.
#
# Permission is hereby granted, free of charge, to any person obtaining
# a copy of Pipchix and associated documentation files (the
# "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, sublicense, and/or sell copies of the Software, and to
# permit persons to whom the Software is furnished to do so, subject to
# the following conditions:
# 
# The above copyright notice and this permission notice shall be
# included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#

AT_SETUP([setup_message(syntax)])

AT_KEYWORDS([default_keywords syntax])

m4_define([sexpr],
  [(let ()
    (scheme->nix
     (stx (stx-quote
           (stx-map '\''(lambda (t) (cons 10 t))
                    '\''(('\''1)
                         ('\''2)
                         ('\''3)
                         ('\''4)))))))])
check_unquoted([run_scheme 'sexpr'],[0],
  [interpunct_nl([])],[])

dnl     (stx (stx-quote (stx-concatMap
dnl                      '\''(stx-cons '\''10)
dnl                      '\''((1) (2) (3) (4))))))])

dnl     (define-syntax stx-concatMap
dnl       (syntax-rules ()
dnl         ((¶ s f x)
dnl          (stx-ck s (stx-concatenate (stx-map f x))))))

dnl m4_define([sexpr],
dnl   [(let ()
dnl dnl     (define-syntax stx-concatMap
dnl dnl       (syntax-rules ( quote )
dnl dnl         ((¶ s '\''f '\''())
dnl dnl          (stx-ck s '\''()))
dnl dnl         ((¶ s '\''(f ...) '\''(h . t))
dnl dnl          (stx-ck s (stx-append
dnl dnl                     (f ... '\''h)
dnl dnl                     (stx-concatMap '\''(f ...) '\''t))))))
dnl      (define-syntax stx-perm
dnl        (syntax-rules ( quote )
dnl          ((¶ s '\''())
dnl           (stx-ck s '\''(())))
dnl          ((¶ s '\''(h . t))
dnl           (stx-ck s (stx-concatenate (stx-map
dnl                      '\''(stx-ins '\''h) (stx-perm '\''t)))))))
dnl      (define-syntax stx-ins
dnl        (syntax-rules ( quote )
dnl         ((¶ s '\''x '\''())
dnl          (stx-ck s '\''((x))))
dnl         ((¶ s '\''x '\''(h . t)) 
dnl          (stx-ck s (stx-cons '\''(x h . t)
dnl                              (stx-map '\''(stx-cons '\''h)
dnl                                       (stx-ins '\''x '\''t)))))))
dnl      (define-syntax perm
dnl        (syntax-rules ()
dnl          ((¶ . args)
dnl           (stx (stx-quote (stx-perm '\''args))))))
dnl      (scheme->nix (perm 1 2 3)))])
dnl check_unquoted([run_scheme 'sexpr'],[0],
dnl   [interpunct_nl([])],[])



dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x)
dnl                    (if-stx-number x
dnl                      (scheme->nix "yes")
dnl                      (scheme->nix "no")))))
dnl               (nix-list (test 4) (test "4")))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-boolean y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      @%:@f
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("no")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-number y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      "4"
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-exact y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      4.0
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-inexact y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      4.0
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("no")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-exact-integer y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      4.0
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-integer y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4.0
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      4.1
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-rational y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      +inf.0
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-real y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      +i
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-complex y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      +i
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-symbol y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      special-guest
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      "4"
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-string y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      4
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      "4"
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("no")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-char y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      @%:@\backspace
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      "4"
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-vector y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      @%:@\backspace
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      @%:@(1 2 3)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("no")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-bytevector y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      m4_case(rnrs_version,6,@%:@vu8(1 2 3),
dnl                                           7,@%:@u8(1 2 3))
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      @%:@(1 2 3)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-null y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      ()
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      (1 2 3)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-pair y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      ()
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      (1 . 2)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("no")·("yes")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-list y
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      (1 2)
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      (1 . 2)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x y z)
dnl                    (if-stx-satisfied ((lambda (a)
dnl                                       (and (list? a)
dnl                                            (= (length a) 2)))
dnl                                     y)
dnl                      (scheme->nix x)
dnl                      (scheme->nix z)))))
dnl               (nix-list
dnl                (test (scheme->nix "yes")
dnl                      (1 2)
dnl                      (scheme->nix "no"))
dnl                (test (scheme->nix "yes")
dnl                      (1 2 3)
dnl                      (scheme->nix "no"))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·("yes")·("no")·@:>@·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ (x . y))
dnl                    (stx-car (x . y)))))
dnl               (scheme->nix (test (123 . 456))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([(123)·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ (x . y))
dnl                    (stx-cdr (x . y)))))
dnl               (scheme->nix (test (123 . 456))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([(456)·])],[])
dnl  
dnl  m4_foreach([number],[1,2,3,4,5,6,7,8,9,10,10],[
dnl  m4_pushdef([ordinal],m4_case(number,
dnl  [1],[first],
dnl  [2],[second],
dnl  [3],[third],
dnl  [4],[fourth],
dnl  [5],[fifth],
dnl  [6],[sixth],
dnl  [7],[seventh],
dnl  [8],[eighth],
dnl  [9],[ninth],
dnl  [10],[tenth],
dnl  [10],[last]))
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ (x ...))
dnl                    (stx-ordinal (x ...)))))
dnl               (scheme->nix (test (1 2 3 4 5 6 7 8 9 10))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([(number)·])],[])
dnl  m4_popdef([ordinal])
dnl  ])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ x)
dnl                    (stx-last-pair x))))
dnl               (scheme->nix (test (1 2 3 4 5 (lambda () 12345)))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([(12345)·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ (x ...))
dnl                    (stx-length (x ...)))))
dnl               (scheme->nix (test (1 2 3 4 5))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([(5)·])],[])
dnl  
dnl  m4_define([sexpr],
dnl    [(let ((proc
dnl             (lambda ()
dnl               (define-syntax test
dnl                 (syntax-rules ()
dnl                   ((_ (x ...))
dnl                    (stx-reverse (x ...)))))
dnl               (scheme->nix (test (4 3 2 1 list))))))
dnl       (proc))])
dnl  check_unquoted([run_scheme 'sexpr'],[0],
dnl    [interpunct_nl([@<:@·(1)·(2)·(3)·(4)·@:>@·])],[])

AT_CLEANUP

# local variables:
# mode: autoconf
# coding: utf-8
# end:
